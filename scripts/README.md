Для работы на сервере нужен [Chrome version 114](https://mirror.cs.uchicago.edu/google-chrome/pool/main/g/google-chrome-stable/) и библиотеки из requirements.txt.
Примерные шаги установки описаны в run.sh.

Парсер на 1) этапе по списку городов формирует словарь город - id одного отделения банка в яндекс картах. Например, для альфа банка в [Ржеве](https://yandex.ru/maps/org/alfa_bank/34376605990/?ll=34.328759%2C56.265052&z=16) будет записано id отделения 34376605990 {‘Ржев’: 34376605990}. 
На 2) этапе переходим по ссылке с этим id в раздел [филиалы](https://yandex.ru/maps/org/alfa_bank/34376605990/chain/?ll=34.328759%2C56.265052&z=16) и из списка отделений банков города достаём все id отделений (как правило это все отделения этого банк в этом городе, но не всегда).

Далее по этому списку отделений банков-ссылок 3) можем спарсить информацию об отделениях или 4) [отзывы](https://yandex.ru/maps/org/alfa_bank/34376605990/reviews/?ll=34.328759%2C56.265052&z=16).
Первые два этапа можно запускать редко (новые банки редко появляются). Этап 3 работает около 3 дней для 1 банка по всем городам (можно оптимизировать/ускорить).


Этап 1.
Используется официальное яндекс API Поиска по организациям, нужно завести api-token на [сайте](https://developer.tech.yandex.ru/services) и записать его в config.py в переменную apikey. Ограничения по запросам - 50 в секунду, 500 в сутки. 
Код  в call_yandex_api_org.py, основная функция вызова апи - get_cities_dict(). Из списка городов cities.txt создаём файлик с пустым словарём город-яндекс id, называется cities_dict_{bank_name}.pickle. Если отделения банка в городе не найдено - значение в словаре 0.
TODO: проверка, что количество городов cities.txt не сильно больше, чем в cities_dict_{bank_name}.pickle. Если в словаре не хватает городов - вызов основной функции вызова апи. 
Важно в списке городов прописывать букву “ё” (Пугачёв и прочее).


Этап 2-3.
Код по формированию ссылок и получению инфо в pipeline_info.py. 


Этап 4.
Логика: Проходимся по всем городам для банка N -> в городе N получаемя все отделения 
3 ->  для каждого отделения получаем список отзывов. Код в pipeline_review, основная функция get_all_reviews().
Предполагается, что ссылки для всех отделений банков уже готовы на шаге 2 - TODO: сделать шаг 2 независимым.  